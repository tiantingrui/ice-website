<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>模板编译 | 忘带伞的阿离</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="assets/favicon.ico">
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.e5597b9c.css" as="style"><link rel="preload" href="/assets/js/app.3b0a3e49.js" as="script"><link rel="preload" href="/assets/js/2.19ec9ae7.js" as="script"><link rel="preload" href="/assets/js/76.9306ea0e.js" as="script"><link rel="prefetch" href="/assets/js/10.715a2627.js"><link rel="prefetch" href="/assets/js/11.47e96749.js"><link rel="prefetch" href="/assets/js/12.9ecc46a2.js"><link rel="prefetch" href="/assets/js/13.172a9863.js"><link rel="prefetch" href="/assets/js/14.2bfff740.js"><link rel="prefetch" href="/assets/js/15.3c00d609.js"><link rel="prefetch" href="/assets/js/16.822b1be9.js"><link rel="prefetch" href="/assets/js/17.e73c455e.js"><link rel="prefetch" href="/assets/js/18.e9b892c6.js"><link rel="prefetch" href="/assets/js/19.bc3515c1.js"><link rel="prefetch" href="/assets/js/20.cbf1914e.js"><link rel="prefetch" href="/assets/js/21.146329ca.js"><link rel="prefetch" href="/assets/js/22.8b901dd2.js"><link rel="prefetch" href="/assets/js/23.1860a1f8.js"><link rel="prefetch" href="/assets/js/24.aa28c18f.js"><link rel="prefetch" href="/assets/js/25.397a36fb.js"><link rel="prefetch" href="/assets/js/26.7faed0cd.js"><link rel="prefetch" href="/assets/js/27.61a37b19.js"><link rel="prefetch" href="/assets/js/28.ed57d33e.js"><link rel="prefetch" href="/assets/js/29.23de2ec9.js"><link rel="prefetch" href="/assets/js/3.127cda67.js"><link rel="prefetch" href="/assets/js/30.f98635ec.js"><link rel="prefetch" href="/assets/js/31.71fb8045.js"><link rel="prefetch" href="/assets/js/32.206af137.js"><link rel="prefetch" href="/assets/js/33.9175747b.js"><link rel="prefetch" href="/assets/js/34.76cee98a.js"><link rel="prefetch" href="/assets/js/35.6022a987.js"><link rel="prefetch" href="/assets/js/36.342b5c41.js"><link rel="prefetch" href="/assets/js/37.5c3b31c3.js"><link rel="prefetch" href="/assets/js/38.22e79235.js"><link rel="prefetch" href="/assets/js/39.782a1fe2.js"><link rel="prefetch" href="/assets/js/4.8c2a2ecd.js"><link rel="prefetch" href="/assets/js/40.96127710.js"><link rel="prefetch" href="/assets/js/41.bf48f5bc.js"><link rel="prefetch" href="/assets/js/42.d7bd0a17.js"><link rel="prefetch" href="/assets/js/43.1d0eb0b5.js"><link rel="prefetch" href="/assets/js/44.b7b61a9e.js"><link rel="prefetch" href="/assets/js/45.e14d1d87.js"><link rel="prefetch" href="/assets/js/46.7a8aad82.js"><link rel="prefetch" href="/assets/js/47.7fdfa701.js"><link rel="prefetch" href="/assets/js/48.65126d0c.js"><link rel="prefetch" href="/assets/js/49.f6f53b16.js"><link rel="prefetch" href="/assets/js/5.08964560.js"><link rel="prefetch" href="/assets/js/50.7c4fe688.js"><link rel="prefetch" href="/assets/js/51.7bac877c.js"><link rel="prefetch" href="/assets/js/52.9a117bce.js"><link rel="prefetch" href="/assets/js/53.79312f7f.js"><link rel="prefetch" href="/assets/js/54.3593b6d7.js"><link rel="prefetch" href="/assets/js/55.95c24bc6.js"><link rel="prefetch" href="/assets/js/56.41fb255e.js"><link rel="prefetch" href="/assets/js/57.b686fbc5.js"><link rel="prefetch" href="/assets/js/58.a1f7bd4d.js"><link rel="prefetch" href="/assets/js/59.b42c81f4.js"><link rel="prefetch" href="/assets/js/6.b58d196a.js"><link rel="prefetch" href="/assets/js/60.a2568988.js"><link rel="prefetch" href="/assets/js/61.702a6eb3.js"><link rel="prefetch" href="/assets/js/62.5a7b80e5.js"><link rel="prefetch" href="/assets/js/63.5b372b3f.js"><link rel="prefetch" href="/assets/js/64.1ad0d3c2.js"><link rel="prefetch" href="/assets/js/65.c642ad7f.js"><link rel="prefetch" href="/assets/js/66.db95d573.js"><link rel="prefetch" href="/assets/js/67.ab471c3b.js"><link rel="prefetch" href="/assets/js/68.c388d7ce.js"><link rel="prefetch" href="/assets/js/69.f05c8a12.js"><link rel="prefetch" href="/assets/js/7.c734d372.js"><link rel="prefetch" href="/assets/js/70.2b834111.js"><link rel="prefetch" href="/assets/js/71.e90df556.js"><link rel="prefetch" href="/assets/js/72.fe53969f.js"><link rel="prefetch" href="/assets/js/73.bc851622.js"><link rel="prefetch" href="/assets/js/74.e0913b28.js"><link rel="prefetch" href="/assets/js/75.c46a8879.js"><link rel="prefetch" href="/assets/js/77.dc1895b9.js"><link rel="prefetch" href="/assets/js/78.d10ba194.js"><link rel="prefetch" href="/assets/js/79.1bb8e196.js"><link rel="prefetch" href="/assets/js/8.89d3e99f.js"><link rel="prefetch" href="/assets/js/80.6dc359a8.js"><link rel="prefetch" href="/assets/js/81.4c14d22b.js"><link rel="prefetch" href="/assets/js/82.feaaab26.js"><link rel="prefetch" href="/assets/js/9.c2c6d501.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e5597b9c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">忘带伞的阿离</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/vue/" class="nav-link router-link-active">
  web前端
</a></div><div class="nav-item"><a href="https://github.com/tiantingrui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/vue/" class="nav-link router-link-active">
  web前端
</a></div><div class="nav-item"><a href="https://github.com/tiantingrui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/html-css" class="sidebar-heading clickable"><span>html &amp; css</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/js" class="sidebar-heading clickable"><span>JS基础（ECMA 262标准）</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/js-async" class="sidebar-heading clickable"><span>JS异步编程</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/js-web-api" class="sidebar-heading clickable"><span>JS-Web-API</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/vue" class="sidebar-heading clickable router-link-active open"><span>Vue</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue/mvvm.html" class="sidebar-link">什么是MVVM</a></li><li><a href="/vue/observe.html" class="sidebar-link">Vue响应式</a></li><li><a href="/vue/vdom.html" class="sidebar-link">vdom</a></li><li><a href="/vue/diff.html" class="sidebar-link">深入diff算法</a></li><li><a href="/vue/compiler.html" aria-current="page" class="active sidebar-link">模板编译</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue/compiler.html#with-语法" class="sidebar-link">with 语法</a></li><li class="sidebar-sub-header"><a href="/vue/compiler.html#编译模板" class="sidebar-link">编译模板</a></li><li class="sidebar-sub-header"><a href="/vue/compiler.html#vue-组件可用-render-代替template" class="sidebar-link">vue 组件可用 render 代替template</a></li><li class="sidebar-sub-header"><a href="/vue/compiler.html#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/vue/compiler.html#vue-组件是如何渲染和更新的" class="sidebar-link">vue 组件是如何渲染和更新的</a></li><li class="sidebar-sub-header"><a href="/vue/compiler.html#总结1-vue原理的三大部分" class="sidebar-link">总结1 - Vue原理的三大部分</a></li><li class="sidebar-sub-header"><a href="/vue/compiler.html#总结2-vue-组件是如何渲染和更新的" class="sidebar-link">总结2 - vue 组件是如何渲染和更新的</a></li></ul></li><li><a href="/vue/router.html" class="sidebar-link">前端路由原理</a></li><li><a href="/vue/proxy.html" class="sidebar-link">Vue3 响应式原理</a></li><li><a href="/vue/topic.html" class="sidebar-link">Vue 总结</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/react" class="sidebar-heading clickable"><span>React</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/node" class="sidebar-heading clickable"><span>Node</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/front-project" class="sidebar-heading clickable"><span>前端工程化</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/network" class="sidebar-heading clickable"><span>计算机网络</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/source-code" class="sidebar-heading clickable"><span>手写源码系列</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/design-model" class="sidebar-heading clickable"><span>设计模式</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/algorithms" class="sidebar-heading clickable"><span>数据结构与算法</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/interview" class="sidebar-heading clickable"><span>面试总结</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="模板编译"><a href="#模板编译" class="header-anchor">#</a> 模板编译</h1> <ul><li>模板是vue 开发中最常用的部分，即与使用相关联的原理</li> <li>他不是 html、有指令、插值、JS表达式，到底是什么？</li> <li>面试不会直接问，但会通过“组件渲染和更新过程”考察</li></ul> <h3 id="核心知识点"><a href="#核心知识点" class="header-anchor">#</a> 核心知识点</h3> <ul><li>前置知识：JS 的 with 语法</li> <li>vue template complier 将模板编译为 render 函数</li> <li>执行render 函数生成 vnode</li></ul> <h2 id="with-语法"><a href="#with-语法" class="header-anchor">#</a> with 语法</h2> <div class="language- extra-class"><pre class="language-text"><code>const obj = {a: 100, b: 200}
console.log(obj.a)
console.log(obj.b)
console.log(obj.c) // undefined

// 使用 with,能改变 {} 内自由变量的查找方式
// 将 {} 内自由变量，当作 obj的属性来查找
with(obj) {
    console.log(a)
    console.log(b)
    console.log(c) // 会报错！！
    
}
</code></pre></div><ul><li>能改变 {} 内自由变量的查找方式，当作 obj 属性来查找</li> <li>如果找不到匹配的 obj 属性，就会报错</li> <li>with 要慎用，它打破了作用域规则，易读性变差</li></ul> <h2 id="编译模板"><a href="#编译模板" class="header-anchor">#</a> 编译模板</h2> <ul><li>模板不是html，有指令，插值、JS表达式，能实现判断、循环</li> <li>html是标签语言，只有JS才能实现判断、循环（图灵完备的）</li> <li>因此，模板一定是转换为某种JS代码，即编译模板</li></ul> <div class="language- extra-class"><pre class="language-text"><code>npm i vue-template-compiler --save
const compiler = require('vue-template-compiler')

// 插值
const template = `&lt;p&gt;{{message}}&lt;/p&gt;`
with(this) {
    return _c('p', [_v(_s(message))])
}
h -&gt; vnode
createElement -&gt; vnode

// 表达式
const template2 = `&lt;p&gt; {{flag ？ message : 'no message found'}} &lt;/p&gt;`
with(this) {
    return _c('p', [
        -v(_s(flag ? message : 'no message found'))
    ])
}

// 属性 v-if .....
</code></pre></div><h3 id="编译模板原理"><a href="#编译模板原理" class="header-anchor">#</a> 编译模板原理</h3> <ul><li>模板编译为render 函数，执行render 函数返回 vnode</li> <li>基于 vnode 再执行 patch 和 diff</li> <li>使用 webpack vue-loader，会在开发环境下编译模板（重要</li></ul> <h2 id="vue-组件可用-render-代替template"><a href="#vue-组件可用-render-代替template" class="header-anchor">#</a> vue 组件可用 render 代替template</h2> <div class="language- extra-class"><pre class="language-text"><code>Vue.component('heading', {
	// template: `xxxx`,
	render: function(createElement) {
		return createElement(
			'h' + this.level,
			[
				createElement('a', {
					attrs: {name: 'headerId', href: '#'}
				}, 'this is a tag')
			]
		)
	}
})
</code></pre></div><ul><li>理解了模板编译之后，再讲这个render，就比较好理解了</li> <li>在有些复杂情况中，不能用template，可以考虑用render</li> <li>React 一直都用 render (没有模板)，和这里一样</li></ul> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <ul><li>with 语法</li> <li>模板到render 函数，再到 vnode ，再到渲染和更新</li> <li>vue 组件可以用render 代替 template</li></ul> <h1 id="回顾总结-vue-原理"><a href="#回顾总结-vue-原理" class="header-anchor">#</a> 回顾总结 vue 原理</h1> <h4 id="组件-渲染-更新-过程"><a href="#组件-渲染-更新-过程" class="header-anchor">#</a> 组件 渲染/更新 过程</h4> <ul><li>一个组件渲染到页面，修改data 触发更新（数据驱动视图）</li> <li>其背后原理是什么，需要掌握那些要点？</li> <li>考察对流程了解的全面程度</li></ul> <h3 id="回顾vue-原理三大只是带你"><a href="#回顾vue-原理三大只是带你" class="header-anchor">#</a> 回顾Vue 原理三大只是带你</h3> <ul><li>响应式：监听data 属性 getter setter （包括数组）</li> <li>模板编译：模板到render 函数，再到 vnode</li> <li>vdom: patch（elem, vnode）和 patch(vnode, newVnode)</li></ul> <h5 id="组件-渲染-更新-过程-的主要要点"><a href="#组件-渲染-更新-过程-的主要要点" class="header-anchor">#</a> 组件 渲染/更新 过程 的主要要点</h5> <ul><li>初次渲染过程</li> <li>更新过程</li> <li>异步渲染</li></ul> <h2 id="vue-组件是如何渲染和更新的"><a href="#vue-组件是如何渲染和更新的" class="header-anchor">#</a> vue 组件是如何渲染和更新的</h2> <h3 id="初次渲染过程"><a href="#初次渲染过程" class="header-anchor">#</a> 初次渲染过程</h3> <ul><li>解析模板为 render 函数（或在开发环境已完成，vue-loader）</li> <li>触发响应式，监听data属性 getter setter (执行render 函数会触发 getter)</li> <li>执行 render 函数，生成 vnode ，patch(elem，vnode)</li></ul> <h3 id="更新过程"><a href="#更新过程" class="header-anchor">#</a> 更新过程</h3> <ul><li>修改data，触发 setter （此前在 getter 中已被监听）</li> <li>重新执行render 函数，生成 newVnode</li> <li>patch(vnode， newVnode)</li></ul> <h3 id="异步渲染"><a href="#异步渲染" class="header-anchor">#</a> 异步渲染</h3> <ul><li>回顾 nextTick()</li> <li>汇总data的修改，一次性更新视图</li> <li>减少DOM操作次数，提高性能</li></ul> <h2 id="总结1-vue原理的三大部分"><a href="#总结1-vue原理的三大部分" class="header-anchor">#</a> 总结1 - Vue原理的三大部分</h2> <ul><li>渲染和响应式的关系</li> <li>渲染和模板编译的关系</li> <li>渲染和vdom的关系</li></ul> <h2 id="总结2-vue-组件是如何渲染和更新的"><a href="#总结2-vue-组件是如何渲染和更新的" class="header-anchor">#</a> 总结2 - vue 组件是如何渲染和更新的</h2> <ul><li>初次渲染过程</li> <li>更新过程</li> <li>异步渲染</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vue/diff.html" class="prev">
        深入diff算法
      </a></span> <span class="next"><a href="/vue/router.html">
        前端路由原理
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><div class="cat-container" data-v-a13867c0><canvas id="vuepress-cat" width="280" height="250" class="live2d" data-v-a13867c0></canvas></div></div></div>
    <script src="/assets/js/app.3b0a3e49.js" defer></script><script src="/assets/js/2.19ec9ae7.js" defer></script><script src="/assets/js/76.9306ea0e.js" defer></script>
  </body>
</html>
